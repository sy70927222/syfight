<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8" />
  
  <title>近期Docker的学习 | 顾里°</title>
  <meta name="author" content="Smith°" />

  
  <meta name="description" content="基本指令12345docker pull 				//安装镜像service docker restart		//服务重启docker ps -a 				//全局容器运行状态查看docker images				//镜像查看docker restart 				//重启容器
MySql 主从容器配" />
  

  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <meta property="og:title" content="近期Docker的学习" />
  <meta property="og:site_name" content="顾里°" />

  
  

  
    <meta property="og:image" content="" />
  

  
  <link href="/syfight/css/images/favicon.ico" rel="icon" />
  

  <link rel="alternate" href="/syfight/atom.xml" title="顾里°" type="application/atom+xml">
  <link rel="stylesheet" href="/syfight/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/syfight/css/miss.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/syfight/css/share.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/syfight/layui/css/layui.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/syfight/layui/css/modules/layer/default/layer.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/syfight/css/css/font-awesome.min.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->


</head>


<body>
<aside id="sidebar" class="site-tree">
  <div class="is open">
    <div class="li x"></div>
    <div class="li y"></div>
    <div class="li z"></div>
</div>
<div id="head">
    <div class="layui-inline" style="display: block">
        <img width="70" height="70" src="/syfight/images/head/1.gif" class="layui-circle">
    </div>
    <h1><a href="/syfight/">顾里°</a></h1>
    <h4 style="margin: 15px 0 0 30px;"><li >众里寻他千百度</li></h4>
    <!--<h4 style="margin: -5px 0 0 58px;"><li >蓦然回首</li></h4>-->
    <h4 style="margin: -5px 0 0 85px;"><li >那人却在灯火阑珊处</li></h4>
</div>

  
<ul id="nav" class="layui-nav layui-nav-tree layui-bg-cyan layui-inline" lay-filter="demo">
    <li class="layui-nav-item">
        <a href="/syfight"><i class="layui-icon">&#xe68e;</i>首页</a>
    </li>
    <li class="layui-nav-item">
        <a href="/syfight/archives"><i class="layui-icon">&#xe622;</i>大事记</a>
    </li>
    <li class="layui-nav-item">
        <a href="/syfight/music"><i class="fa fa-music"></i>音乐盒</a>
    </li>
    <li class="layui-nav-item">
        <a href="/syfight/photo"><i class="layui-icon">&#xe60d;</i>相册</a>
    </li>
    <li class="layui-nav-item">
        <a href="/syfight/about"><i class="layui-icon">&#xe60b;</i>关于</a>
    </li>
</ul>


</aside>
<div id="con">
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/syfight/">顾里°</a></h1>
  <!--<h2><a href="/syfight/"></a></h2>-->
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/syfight">首页</a></li>
    
      <li><a href="/syfight/archives">大事记</a></li>
    
      <li><a href="/syfight/music">音乐盒</a></li>
    
      <li><a href="/syfight/photo">相册</a></li>
    
      <li><a href="/syfight/about">关于</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="site-content"><div id="wrapper"><article class="draft">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2017-11-24T07:56:00.000Z"><a href="/syfight/2017/11/24/Docker-虚拟机/">2017-11-24 15:56:00</a></time>
      
      
  
    <h1 class="title">近期Docker的学习</h1>
  

    </header>
    <div class="entry">
      
        <h2 id="基本指令"><a href="#基本指令" class="headerlink" title="基本指令"></a>基本指令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">docker pull 				//安装镜像</div><div class="line">service docker restart		//服务重启</div><div class="line">docker ps -a 				//全局容器运行状态查看</div><div class="line">docker images				//镜像查看</div><div class="line">docker restart 				//重启容器</div></pre></td></tr></table></figure>
<h2 id="MySql-主从容器配置及同步"><a href="#MySql-主从容器配置及同步" class="headerlink" title="MySql 主从容器配置及同步"></a>MySql 主从容器配置及同步</h2><p>1.创建mysql-master服务器配置及数据目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir /home/zhumisi/mysql/master/conf</div><div class="line">mkdir /home/zhumisi/mysql/master/data</div></pre></td></tr></table></figure></p>
<p>2.创建mysql-slave服务器配置及数据目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir /home/zhumisi/mysql/slave/conf</div><div class="line">mkdir /home/zhumisi/mysql/slave/data</div></pre></td></tr></table></figure></p>
<ul>
<li><p>master配置目录下手动创建my.cnf文件,配置如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[mysqld]</div><div class="line">server_id = 1</div><div class="line">log-bin= mysql-bin</div><div class="line">binlog-format=ROW</div><div class="line">//</div><div class="line">binlog-do-db=bfftrip</div><div class="line">replicate-ignore-db=mysql</div><div class="line">replicate-ignore-db=sys</div><div class="line">replicate-ignore-db=information_schema</div><div class="line">replicate-ignore-db=performance_schema</div><div class="line">//</div><div class="line">read-only=0</div><div class="line">relay_log=mysql-relay-bin</div><div class="line">log-slave-updates=on</div><div class="line">auto-increment-offset=1</div><div class="line">auto-increment-increment=2</div><div class="line">//</div><div class="line">!includedir /etc/mysql/conf.d/</div><div class="line">!includedir /etc/mysql/mysql.conf.d/</div></pre></td></tr></table></figure>
</li>
<li><p>slave配置目录下手动创建my.cnf文件,配置如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[mysqld]</div><div class="line">server_id = 2</div><div class="line">log-bin= mysql-bin</div><div class="line">//</div><div class="line">binlog-do-db=bfftrip</div><div class="line">replicate-ignore-db=mysql</div><div class="line">replicate-ignore-db=sys</div><div class="line">replicate-ignore-db=information_schema</div><div class="line">replicate-ignore-db=performance_schema</div><div class="line">//</div><div class="line">read-only=0</div><div class="line">relay_log=mysql-relay-bin</div><div class="line">log-slave-updates=on</div><div class="line">auto-increment-offset=2</div><div class="line">auto-increment-increment=2</div><div class="line">//</div><div class="line">!includedir /etc/mysql/conf.d/</div><div class="line">!includedir /etc/mysql/mysql.conf.d/</div></pre></td></tr></table></figure>
</li>
</ul>
<p>3.安装mysql镜像:版本号<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docker pull mysql:5.7.18  </div><div class="line">service docker restart	//服务器重启</div></pre></td></tr></table></figure></p>
<p>4.运行mysql-master主服务器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">docker run -d --restart always --name mysql-master \</div><div class="line">    -v /home/zhumisi/mysql/master/conf:/etc/mysql/conf.d \</div><div class="line">    -v /home/zhumisi/mysql/master/data:/var/lib/mysql \</div><div class="line">    -p 3307:3306 \</div><div class="line">    -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7.18</div></pre></td></tr></table></figure></p>
<p>5.运行mysql-slave从服务器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">docker run -d --restart always --name mysql-slave \</div><div class="line">    -v /home/zhumisi/mysql/slave/conf:/etc/mysql/conf.d \</div><div class="line">    -v /home/zhumisi/mysql/slave/data:/var/lib/mysql \</div><div class="line">    -p 3308:3306 \</div><div class="line">    -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7.18</div></pre></td></tr></table></figure></p>
<p>6..NetworkSettings.IPAddress=0ae5cee7cc17通过ID查看容器端口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker inspect --format=&apos;&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;&apos;</div></pre></td></tr></table></figure></p>
<p>7.进入主或从服务器目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docker exec -it mysql-master bash</div><div class="line">docker exec -it mysql-slave bash</div></pre></td></tr></table></figure></p>
<p>8.启动mysql命令，刚在创建窗口时我们把密码设置为：123456<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql -u root -p</div></pre></td></tr></table></figure></p>
<p>9.mysql-master服务器创建主从同步用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">GRANT REPLICATION SLAVE ON *.* to &apos;bfftrip&apos;@&apos;%&apos; identified by &apos;123456&apos;;</div></pre></td></tr></table></figure></p>
<p>10.mysql-master服务器创建canal用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">GRANT REPLICATION SLAVE ON *.* to &apos;canal&apos;@&apos;%&apos; identified by &apos;canal&apos;;</div></pre></td></tr></table></figure></p>
<p>11.mysql-master服务器查看master运行状态 获取偏移量及binlog日志文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">show master status</div></pre></td></tr></table></figure></p>
<p>12.mysql-slave服务器设置主库链接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">change master to master_host=&apos;192.168.226.128&apos;, master_user=&apos;bfftrip&apos;, master_password=&apos;123456&apos;, master_port=3307, master_log_file=&apos;mysql-bin.000004&apos;, master_log_pos=445, master_connect_retry=30;</div></pre></td></tr></table></figure></p>
<p>13.mysql-slave服务器查看主从同步状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">show slave status \G;</div></pre></td></tr></table></figure></p>
<h2 id="Docker-配置JDK环境变量"><a href="#Docker-配置JDK环境变量" class="headerlink" title="Docker 配置JDK环境变量"></a>Docker 配置JDK环境变量</h2><p>1.Ubuntu打开配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$sudo gedit ~/.bashrc</div></pre></td></tr></table></figure></p>
<ul>
<li>在文件末尾加上以下内容（JDK所解压的路径）<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">export JAVA_HOME=/home/zhumisi/java/java1.8</div><div class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</div><div class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib  </div><div class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH</div></pre></td></tr></table></figure>
</li>
</ul>
<p>2.执行文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source ~/.bashrc</div></pre></td></tr></table></figure></p>
<p>3.JDK是否安装成功<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -version</div></pre></td></tr></table></figure></p>
<h2 id="Canal的相关部署"><a href="#Canal的相关部署" class="headerlink" title="Canal的相关部署"></a>Canal的相关部署</h2><p>1.下载Canal<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://github.com/alibaba/canal/releases/download/canal-1.0.24/canal.deployer-1.0.24.tar.gz</div></pre></td></tr></table></figure></p>
<p>2.创建Canal目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir /home/zhumisi/canal</div></pre></td></tr></table></figure></p>
<p>3.canal.deployer-1.0.24.tar.gz压缩包解压到指定路径下的canal里<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar zxvf canal.deployer-1.0.24.tar.gz  -C /home/zhumisi/canal</div></pre></td></tr></table></figure></p>
<p>4.启动Canal<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sh /home/zhumisi/canal/bin/startup.sh</div></pre></td></tr></table></figure></p>
<p>5.关闭canal<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sh /home/zhumisi/canal/bin/stop.sh</div></pre></td></tr></table></figure></p>
<p>6.查看相关日志<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cat /home/zhumisi/canal/logs/canal/canal.log</div><div class="line">cat /home/zhumisi/canal/logs/example/example.log</div></pre></td></tr></table></figure></p>
<p>7.Canal配置文件查看<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /home/zhumisi/canal/conf/canal.properties</div></pre></td></tr></table></figure></p>
<h2 id="Kafka的相关部署"><a href="#Kafka的相关部署" class="headerlink" title="Kafka的相关部署"></a>Kafka的相关部署</h2><p>1.安装ZK镜像<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker pull wurstmeister/zookeeper</div></pre></td></tr></table></figure></p>
<p>2.安装Kafka镜像<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker pull wurstmeister/kafka</div></pre></td></tr></table></figure></p>
<p>3.启动zookeeper容器运行ZK<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -d --name zookeeper --publish 2181:2181 --volume /etc/localtime:/etc/localtime zookeeper:latest</div></pre></td></tr></table></figure></p>
<p>4.启动kafka容器运行Kafka<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">docker run -d --name kafka \</div><div class="line">--publish 9092:9092 --link zookeeper \</div><div class="line">-e KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181 \</div><div class="line">-e KAFKA_ADVERTISED_HOST_NAME=192.168.226.128 \</div><div class="line">-e KAFKA_ADVERTISED_PORT=9092 \</div><div class="line">-v /etc/localtime:/etc/localtime \</div><div class="line">wurstmeister/kafka:latest</div></pre></td></tr></table></figure></p>
<p>5.执行Docker ps，找到kafka的Container ID，进入容器内部：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker exec -it $&#123;CONTAINER ID&#125; /bin/bash	//CONTAINER ID:0f0aec478812</div></pre></td></tr></table></figure></p>
<p>6.移动到kafka文件目录(注意:opt目录下kafka文件夹名称会根据版本不同而不同，所以可以事先移动到opt目录dir查看以下)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd opt/kafka_2.12-1.0.0/</div></pre></td></tr></table></figure></p>
<p>7.创建一个bfftrip 的主题<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bin/kafka-topics.sh --create --zookeeper zookeeper:2181 --replication-factor 1 --partitions 1 --topic bfftrip</div></pre></td></tr></table></figure></p>
<p>8.运行一个消息生产者<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bin/kafka-console-producer.sh --broker-list localhost:9092 --topic bfftrip</div></pre></td></tr></table></figure></p>
<p>9.运行一个消息消费者<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bin/kafka-console-consumer.sh --zookeeper zookeeper:2181 --topic bfftrip --from-beginning</div></pre></td></tr></table></figure></p>
<h2 id="Mongodb数据库的部署"><a href="#Mongodb数据库的部署" class="headerlink" title="Mongodb数据库的部署"></a>Mongodb数据库的部署</h2><p>1.安装Mongo镜像<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker pull mongo:3.2</div></pre></td></tr></table></figure></p>
<p>2.启动mongodb容器运行Mongo<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -d --name mongodb -p 27017:27017 -v $PWD/db:/data/db -d mongo:3.2</div></pre></td></tr></table></figure></p>

      
    </div>
    
    <footer>
        <div class="alignright">
            <div id="ss_menu">
                
                <div data-title="近期Docker的学习" data-url="https://sy70927222.github.io/syfight/2017/11/24/Docker-虚拟机/" data-type="qzone" class="fx child1"><i class="fa fa-qq"></i></div>
                <div data-title="近期Docker的学习" data-url="https://sy70927222.github.io/syfight/2017/11/24/Docker-虚拟机/" data-type="xinlang" class="fx child2"><i class="fa fa-weibo"></i></div>
                <div data-title="近期Docker的学习" data-url="https://sy70927222.github.io/syfight/2017/11/24/Docker-虚拟机/" data-type="weixin" class="fx child3"><i class="fa fa-weixin"></i></div>
                <div data-title="近期Docker的学习" data-url="https://sy70927222.github.io/syfight/2017/11/24/Docker-虚拟机/" data-type="rr" class="fx child4"><i class="fa fa-renren"></i></div>
                
                <div id="share" class="menu">
                    <div class="share ss_toggle" id="ss_toggle" data-rot="180">
                        <div class="circle"></div>
                        <div class="bar"></div>
                    </div>
                </div>
            </div>
        </div>
        
        
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



</div></div>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  <p>
  
  &copy; 2017 Smith°
  
  All rights reserved.</p>
  <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</div>
<div class="clearfix"></div>

<!--<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>--></footer>
</div>
  <script src="/syfight/js/jquery.js"></script>
<script src="/syfight/fancybox/jquery.fancybox.pack.js"></script>


<link rel="stylesheet" href="/syfight/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<!--<div id='bg'></div>-->
<div class="landscape"></div>
<div class="filter">

</div><div id="link" class="site-tree-mobile layui-hide">
  <i class="layui-icon"></i>
</div>
<ul class="layui-fixbar">
  <li id="top" class="layui-icon layui-fixbar-top">&#xe604;</li>
  <li id="down" class="layui-icon layui-fixbar-top">&#xe604;</li>
</ul>
<div class="mask" id="mask"></div>
<canvas id="canvas" style="position: fixed;top:0;left:0px;"></canvas>
<script src="/syfight/js/miss.js"></script>
<script src="/syfight/js/util.js"></script>
<script src="/syfight/js/share.js"></script>
<script src="/syfight/js/qrcode.js"></script>
<script src="/syfight/layui/lay/modules/layer.js"></script>
</body>
</html>